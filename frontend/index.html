<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue.js + Express.js App</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
</head>
<body>
    <div id="app">
        <div class="container">
            <h1>{{ title }}</h1>
            
            <div class="api-section">
                <h3>Hello API</h3>
                <button @click="fetchHello">Get Hello Message</button>
                <div v-if="helloResponse" class="response">{{ helloResponse }}</div>
            </div>
            
            <div class="api-section">
                <h3>Users API</h3>
                <button @click="fetchUsers">Get All Users</button>
                
                <div class="user-form">
                    <h4>Add New User</h4>
                    <input v-model="newUser.name" placeholder="Name" />
                    <input v-model="newUser.email" placeholder="Email" />
                    <button @click="addUser">Add User</button>
                </div>
                
                <div v-if="users.length > 0" class="users-list">
                    <h4>Users:</h4>
                    <div v-for="user in users" :key="user.id" class="user-item">
                        <strong>{{ user.name }}</strong> - {{ user.email }}
                    </div>
                </div>
                
                <div v-if="userResponse" class="response">{{ userResponse }}</div>
            </div>
            
            <div class="api-section">
                <h3>Fairy Tale Search</h3>
                <div v-if="searchStats" class="search-stats">
                    <p><strong>{{ searchStats.totalTales }}</strong> fairy tales available from <a :href="searchStats.baseUrl" target="_blank">Grimm's Fairy Tales</a></p>
                </div>
                
                <div class="search-form">
                    <div class="search-input-group">
                        <input 
                            v-model="searchQuery" 
                            @keyup.enter="searchFairyTales"
                            placeholder="Search for words in fairy tales..." 
                            :disabled="isSearching"
                        />
                        <button @click="searchFairyTales" :disabled="isSearching || !searchQuery.trim()">
                            <span v-if="isSearching">Searching...</span>
                            <span v-else>Search</span>
                        </button>
                        <button @click="clearSearch" class="clear-btn" :disabled="isSearching">Clear</button>
                    </div>
                </div>
                
                <div v-if="searchResponse" class="response">{{ searchResponse }}</div>
                
                <div v-if="searchResults.length > 0" class="search-results">
                    <h4>Search Results:</h4>
                    <div v-for="result in searchResults" :key="result.tale.id" class="search-result">
                        <div class="result-header">
                            <h5>{{ result.tale.title }}</h5>
                            <span class="relevance-score">Relevance: {{ Math.round(result.relevanceScore) }}</span>
                        </div>
                        <div class="result-matches">
                            <div v-for="(match, index) in result.matches.slice(0, 3)" :key="index" class="match-item">
                                <div class="match-line">
                                    <span class="line-number">Line {{ match.lineNumber }}:</span>
                                    <span class="match-text" v-html="highlightMatch(match.line, searchQuery)"></span>
                                </div>
                                <div class="match-context">{{ match.context }}</div>
                            </div>
                            <div v-if="result.matches.length > 3" class="more-matches">
                                ... and {{ result.matches.length - 3 }} more matches
                            </div>
                        </div>
                        <div class="result-actions">
                            <a :href="result.tale.url" target="_blank" class="view-tale-btn">View Full Tale</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="api-section">
                <h3>API Documentation</h3>
                <p>View the complete API documentation with Swagger UI:</p>
                <a href="/swagger" target="_blank" style="display: inline-block; background: #28a745; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">Open Swagger UI</a>
            </div>
        </div>
    </div>

    <script src="/js/app.js"></script>
</body>
</html>
